{% extends 'base.html' %}

{% block title %}Tableau de bord - Pterodactyl Manager{% endblock %}

{% block content %}

<h1>Bienvenue, {{ username }} ğŸ‘‹</h1>

{% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
            <article role="alert">
                {{ message }}
            </article>
        {% endfor %}
    {% endif %}
{% endwith %}

<h2>Vos serveurs</h2>

{% if servers %}
    <table>
        <thead>
            <tr>
                <th>Nom du serveur</th>
                <th>Tier du serveur</th>
                <th>Expiration</th>
                <th>IP</th>
                <th>Liens associÃ©s</th>
            </tr>
        </thead>
        <tbody>
            {% for server in servers %}
                <tr>
                    <td>{{ server.server_name }}</td>
                    <td>{% for tier in tiers %}
                            {% if tier.id == server.tier_id %}
                            <code>{{ tier.name }}</code>
                            {% endif %}
                        {% endfor %}
                    </td>
                    <td>
                    {% set remaining = server.expires_at - now %}
                    {% if remaining <= 0 %}
                        <span style="color: red;">ExpirÃ©, renouvellement requis</span>
                    {% else %}
                        {% set hours = remaining // 3600 %}
                        {% set minutes = (remaining % 3600) // 60 %}
                        {{ hours }}h {{ minutes }}m restantes
                    {% endif %}
                    </td>
                    <td>
                        <code>{% for server_details in servers_details %}   
                                    {% if server_details.attributes.uuid == server.pterodactyl_server_uuid %}
                                        {{ server_details.attributes.relationships.allocations.data[0].attributes.alias }}:{{ server_details.attributes.relationships.allocations.data[0].attributes.port }}
                                    {% endif %}
                                {% endfor %}
                        </code>
                            
                            
                            
                    </td>
                     <td>
                        <a href="{{ url_for('server_infos', uuid=server.pterodactyl_server_uuid|string) }}" role="button" class="outline">
                            Voir dÃ©tails
                        </a>
                        <a href="{{ url_for('renew_server', uuid=server.pterodactyl_server_uuid|string) }}" role="button" class="outline secondary">
                            Renouveler
                        </a>
                        <a href="{{ url_for('panel_redirect', uuid=server.pterodactyl_server_uuid|string) }}" role="button" class="outline contrast">
                            GÃ©rer
                        </a>
                    </td>

                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>
        Vous n'avez encore aucun serveur.<br>
        <a href="{{ url_for('create_server') }}" role="button">ğŸš€ CrÃ©er votre premier serveur</a>
    </p>
{% endif %}

{% endblock %}
